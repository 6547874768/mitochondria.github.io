name: Daily Backup

on:
  schedule:
    # –ó–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 12:00 UTC (15:00 –ú–°–ö)
    - cron: '0 12 * * *'
  workflow_dispatch: # –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–ø—É—Å–∫–∞ –≤—Ä—É—á–Ω—É—é

jobs:
  backup:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    
    - name: Set backup date
      run: |
        echo "BACKUP_DATE=$(date +'%Y-%m-%d-%H%M')" >> $GITHUB_ENV
    
    - name: Create backup archive
      run: |
        # –ü—Ä–æ—Å—Ç–æ–π –∞—Ä—Ö–∏–≤ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
        tar -czf backup-${{ env.BACKUP_DATE }}.tar.gz *.html *.css *.js *.yml *.xml *.txt *.ico *.png 2>/dev/null || true
        ls -lh backup-${{ env.BACKUP_DATE }}.tar.gz
    
    - name: Create backup info
      run: |
        echo "# Health Supplements Hub Backup - ${{ env.BACKUP_DATE }}" > backup-info.md
        echo "Backup created: $(date)" >> backup-info.md
        echo "Repository: ${{ github.repository }}" >> backup-info.md
        echo "Commit: ${{ github.sha }}" >> backup-info.md
        echo "HTML pages: $(ls *.html 2>/dev/null | wc -l)" >> backup-info.md
        echo "Total files in backup: $(tar -tzf backup-${{ env.BACKUP_DATE }}.tar.gz | wc -l)" >> backup-info.md
    
    - name: Create Release with backup
      uses: softprops/action-gh-release@v1
      with:
        tag_name: backup-${{ env.BACKUP_DATE }}
        name: "üì¶ Daily Backup - ${{ env.BACKUP_DATE }}"
        body: |
          üîÑ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–µ–∫–∞–ø**
          
          üìÖ **–î–∞—Ç–∞:** ${{ env.BACKUP_DATE }}
          üè∑Ô∏è **–ö–æ–º–º–∏—Ç:** ${{ github.sha }}
          
          üìä **–í–∫–ª—é—á–µ–Ω–æ –≤ –∞—Ä—Ö–∏–≤:**
          - HTML —Å—Ç—Ä–∞–Ω–∏—Ü—ã (24 —à—Ç)
          - CSS/JS —Ñ–∞–π–ª—ã  
          - GitHub Actions (yml)
          - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (xml, txt)
          - –ò–∫–æ–Ω–∫–∏ –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
          
          üíæ **–°–∫–∞—á–∞—Ç—å:** backup-${{ env.BACKUP_DATE }}.tar.gz
          
          ‚è∞ **–°–ª–µ–¥—É—é—â–∏–π –±–µ–∫–∞–ø:** –∑–∞–≤—Ç—Ä–∞ –≤ 12:00 UTC (15:00 –ú–°–ö)
        files: |
          backup-${{ env.BACKUP_DATE }}.tar.gz
          backup-info.md
        draft: false
        prerelease: false
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    
    - name: Summary
      run: |
        echo "‚úÖ –ë–µ–∫–∞–ø —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!"
        echo "üì¶ –ê—Ä—Ö–∏–≤: backup-${{ env.BACKUP_DATE }}.tar.gz"
        echo "üè∑Ô∏è –†–µ–ª–∏–∑: backup-${{ env.BACKUP_DATE }}"
        echo "üìä –†–∞–∑–º–µ—Ä: $(ls -lh backup-${{ env.BACKUP_DATE }}.tar.gz | awk '{print $5}')"
        echo "‚è∞ –°–ª–µ–¥—É—é—â–∏–π –±–µ–∫–∞–ø: –∑–∞–≤—Ç—Ä–∞ –≤ 12:00 UTC"
